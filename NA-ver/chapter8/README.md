#### Chapter8 Layer3冗長化
- **内容**
  - **デフォルトゲートウェイの冗長化**
  - **HSRP**
  - **VRRP**
  - **GLBP**

- **FHRP**(First Hop Redundancy Protocol)
  - 複数のLayer3デバイスをグループ化して「仮想ルータ」を構成
  - 仮想ルータのデフォルトゲートウェイをファイルオーバーを実現する冗長化プロトコル
  - Cisco独自なのはしたの二つ
    - **HSRP** 
    - **GLBP**

- **HSRP**(Hot Stanby Routing Protocol)
  - 同一のサブネット上の複数ルータでHSRPグループを形成する
  - 複数の物理的なルータ(実ルータ)をあたかも１台かのように見せる**『仮想ルータ』**
  - グループでは1台をアクティブ、一台をスタンバイを選出する
    - アクティブが落ちるとスタンバイが引き継ぐ
  -　グループメンバ
    - **仮想ルータ**
    - **アクティブ**
    - **スタンバイ**
  - ARPリクエストに対しては『仮想MACアドレスが』返される 
  
**[アクティブルータの選出方法]**
  1.  プライオリティが最大のルータ(defaultは100)
  2.  IPアドレスが最大のルータ(プライオリティが同じ場合)

- アクティブルータの役割
  - ARPリクエストに応答する
  - 宛先MACアドレスが仮想MACアドレスが転送する

**[仮想MACアドレス]**
仮想ルータには、HSRPグループ番号を基にした仮想MACアドレスが自動的に割り当てられる
```
HSRPの仮想MACアドレス = 0000.0c07.ac[HSRPグループ番号(16進数)]
```

- HSRP仮想IPアドレスには、同一サブネット上の未使用のIPアドレスが必要
- アクティブルータでは、仮想IPアドレスと仮想MACアドレスがアクティブである
- インターフェース上で複数のHSRPグループを形成し、ロードバンスが可能
- HSRPグループの範囲は[0-255]
- フレーンテキスト認証とMD5認証をサポートしている

- アクティブルータとスタンバイルータ
  - 互いに定期的にHelloメッセージを送信
    - Holdタイマの時間が経過してもHelloを受信できなければ相手がダウンしたと判断
    - デフォルト値は、`Helloタイマ:3秒`、`Holdタイマー10秒`


**[デフォルトゲートウェイの冗長構成化プロトコル]**
- 種類
  - `HSRP` : Cisco独自、Active/Standy方式
  - `VRRP` : RFC標準、Master/Backup方式
    -　マルチベンダ環境で利用可能 
  - `GLBP` : Cisco独自、Load Balancing方式

[VRRPの図]と[HSRPの図]
(引用：http://bit.ly/1WIskWx)

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/vrrp-image.jpg)
![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/hsrp-image.jpeg)

**[VRRPの仮想MACアドレス]**
VRRPの仮想MACアドレスは、先頭から5バイトは固定で『0000.5e00.01』
```
VRRPの仮想MACアドレス = 0000.5e00.01[VRRPグループ番号(16進数)]
```

- VRRPとHSRPの違い
  - VRRPはHSRPとは違い、仮想IPアドレスには物理ルータの実IPアドレスを使用できる

- オブジェクトトラッキング
  - ルーティングテーブルの経路情報などを対象に追跡する機能
  - オブジェクトトラッキングを利用すると、リンク障害の他、様々な状況に応じて転送ルータを切り替えることができる
  - VRRPグループ内で最適なルータがマスタールータになることを保証する


- **GLBP**(Gateway Load Balancing Protocol)
  - シスコが開発したデフォルトゲートウェイの冗長化とロードバランシングを提供するプロトコル
  - 1つのグループだけで、サブネット上の全てのホストに同じ仮想IPアドレスをデフォゲとして割り当てると、自動的にデフォルトゲートウェイのロードバランシングが行われる
  - ルータの物理インターフェースごとに最大1024の仮想ルータグループをサポート
  - 認証方式はブレーンテキストとMD5をサポート

1.  GLBPグループには最大4つの仮想MACアドレスが自動生成
2.  グループ内の各ルータに仮想MACアドレスを割り当てて転送ルータ(デフォゲ)として機能させ、ロードバランシングを実現する
3.  この転送ルータをAVF(Active Virtual Forwarder)という


- GLBPグループ
  - AVGの役割
    - GLBPグループを管理し、どのルータがAVFとして転送処理を行うかを決定
    - AVFの仮想MACアドレスを割り当てる
    - AVGはクライアントからのARPリクエストに対して(最大)4つの仮想MACアドレスのいずれか1つ返答
      - デフォルトではラウンドロビンで応答する
    - 異なる仮想MACアドレスを返答することでロードバランシングする


**[GLBPの仮想MACアドレス]**
```
GLBPの仮想MACアドレス = 0007.b400.[GLBPグループ番号][MACアドレス番号(01-04)]
```

**[GLBPにおけるAVF間のロードバランシング]**
- **ウェイト付きロードバランシング(weighted)**
  - AVFがアドバタイズしているウェイトに基づくロードバランシングを行う。(ウェイト値は大きいほど負荷が高い)
  - **ホスト依存ロードバランシング(host-dependend)**
    - ホストのMACアドレスに基づいて仮想MACアドレスを決定する.各ホストが使用するデフォルトゲートウェイの仮想MACアドレスが常に同じになるようにロードバランスする
  - **ラウンドロビンロードバランス(round-robin)** 
