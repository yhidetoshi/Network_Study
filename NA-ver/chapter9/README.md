#### Chapter9 リンクステートルーティング
- **内容**
  - **リンクステートルーティング**
  - **OSPFの概要**
  - **OSPFの動作**
  - **OSPF基本設定と検証**
  - **OSPFネットワークタイプ**
  - **OSPFのオプション設定**
  - **OSPFのトラブルシューティング**
  - **OSPFv3**



- **リンクステートルーティングプロトコルの特徴**
  - コンバージェンスはディスタンスベクター型より高速
  - ネイバー関係を確立し、リンクステート情報(LSA)を交換
  - ネットワーク全体のトポロジを把握し、リンクステートデータベースを基に最短パスを決定
  - 最短パスの算出にSPFアルゴリズムを使用
  - 効率的なアップデートにより帯域幅の消費が少ない
  - 階層型のエリア設計により、大規模ネットワークに対応できる
  - VLSMをサポートしている
  - イベントトリガのアップデートを行う
  - 代表的なプロトコルはOSPF、IS-IS


- 大規模なOSPFネットワークにおいて階層型構造を使用するメリット
 
|問題点  　　|説明         |
|:-----------|:------------|
|LSDBが大きくなる|OSPFルータはエリア内でLSAをフラッディングし、共通のLSDBを保持するので、規模が大きくなるとLSAトラフィックが増加し、CPUリソースを消費する|
|SPF計算頻度の増加|ネットワークの拡大に伴い、トポロジが変更される回数が増す。そのために各ルータはSPFの再計算とルーティングテーブルの更新に多くのCPUリソースを消費する|
|ルーティングテーブルが大きくなる|エリア境界と自律システムの境界で、経路集約を行う。シングルエリア環境ではOSPFドメイン内の経路集約が行えないため、ルーティングテーブルのサイズが大きくなりメモリを消費する|

|解決策  　　|説明         |
|:-----------|:------------|
|1           |ネットワークを複数のエリアに分割する改造構造にすることで解決| 
|2           |バックボーンエリア(通過エリア)と標準エリア(非バックボーンエリア)の2階層| 
|3           |マルチエリアOSPFによってLSAフラッティング範囲はエリア内に制限され、不安定なネットワークによる影響もエリア内のルータに抑えることができる| 
|4           |エリア境界では複数の経路を1つに集約でき、ルーティングのオーバーヘッドも減少する| 

- OSPF
 - ネイバーのルータと情報をやり取りする
 - 情報を交換する事を **『アドバタイズ』**と呼ぶ』
   - 交換する情報を**『LSA(リンクステートアドバタイズ)』**
 - ネットワークのタイプ
   - Point-to-Point
     - DR/BDRの選出なし
   - マルチアクセス・ネットワーク
     - Broadcast/Non-Broadcast
     - DR/BDRの選出なし

- **DRの選出**
  - DRやBDRはネットワークセグメントごとに1台ずつ選出される
  - このDRやBDRの選出は、Neighborを確立する際のHelloプロトコルの交換による
  - Helloパケットには,DRやBDRの選出に使用されるプライオリティ値やルータIDなどの情報が入力されている
  - 基本的にはプライオリティ値が一番高いものがDR、2番目に高いものがBDRに選出される
    - (*)プライオリティ値: 
      - [0-255]で手動で設定可能
      - 0にした場合、DRもBDRも選出されない 
      - プライオリティ値が同じ場合、最も高いルータIDを持つものがDRやBDRに選出される
    
**[OSPFのBR/BDRの有無のイメージ]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/ospf-lsa.png)
![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/ospf-no-lsa.png)

(引用:http://www.infraexpert.com/study/ospfz7.html)


**[階層化されたOSPFネットワーク図]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/ospf-as.png)

**[ルータの種類]**

|種類  　　　|役割         |
|:-----------|:------------|
|内部ルータ  |すべてのインターフェースが同じエリアに所属しているルータ|
|バックボーンルータ|1以上のインターフェースががバックボーンルータに所属しているルータ|
|ABR         |Area Border Router、2つ以上のエリアに所属しているエリア境界ルータ    |
|ASBR        |AS Boundary Router、非OSPFネットワーク(外部AS)と接続しているAS境界ルータ|



- **OSPFルータが持っているもの**
  - ネイバーテーブル
  - トポロジーテーブル
  - ルーティングテーブル


**[OSPFで使用されるパケット]**

|パケット名  |説明         |
|:-----------|:------------|
|Hello       | ネイバー関係を確立および維持するためのパケット
|DBD         |DataBase Description. LSDBに含まれるLSAのリストをネイバーに提示し、同期するためのパケット |
|LSR|Link State Request. ネイバーにLSAを要求するためのパケット|
|LSU|Link State Update ネイバーから要求されたLSAを送信するためのパケット|
|LSAck|Link State Acknowledgement. DBDやLSUの受信による確認応答|


