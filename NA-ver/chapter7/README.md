設問14を再確認

#### Chapter7 スパニングツリープロトコルとEtherChannel
- **内容**
  - **STPの概要**
  - **STPの基本動作**
  - **STPトポロジの設計**
  - **PortFastとBPDU**
  - **RSTP**
  - **STPおよびRSTPのトラブルシューティング** 
  - **EtherChannelの概要**
  - **EtherChannelの設定と検証**
  - **EtherChannelのトラブルシューティング**

- **ブロードキャストストーム(Layer2ループ)**
  - フラッディングが無限に繰り返されると発生
    - MACアドレステーブルにない場合に行われる 
- **ルーティングループ**
  - Layer3デバイス(ルータ)によって発生
- **輻輳**
  - 処理能力を超えるほどのトラフィックが1箇所に集中してネットワークが混雑している状態 


- **STP**(Spanning Tree Protocol)
  - **IEEE 802.1D**で規定されている
  - スイッチで構成された冗長ネットワークにおいてループを防止する
    - 特定のポートをブロッキング状態にしてフレームの送受信を禁止してブロードキャストストームを防止
    - ブロッキング状態のポートをフォワーディング状態に移行するため、トラフィックパスは自動的に切り替わる

- ルートブリッジ
  - スパニングツリーの中心となるスイッチで、**ルートスイッチ**とも呼ばれる
  - ルーボブリッジを根っこにした論理的なツリーを構成してループの無い冗長ネットワークを作る
  - **最小のブリッジID**を持つスイッチから選出される
  - スイッチの起動時にはルートブリッジを認識していないので、自信がルートブリッジであると想定してBPDUのルートIDフィールドと自身のブリッジIDを比較し、自身のブリッジIDが大きい場合は自身がルートブリッジだと判断する
  - デフォルト2秒間隔でBPDUをマルチキャスト送信する
  - ルートブリッジの全てのポートは指定ポートになりフレームの送受信ができる


- **BPUD(Bridge Protocol Data Unit)**
  - BPDUをやりとりして、各スイッチのポートがフォワーディング状態とブロッキング状態のどちらになるか決定したり、ループを検出する
  - STPが有効なスイッチだけがこれを受診する
  - 役割
    -  ルートブリッジの選出
    -  ループ位置の判別
    -  ネットワーク変更の通知
    -  STPの状態監視



- ブリッジIDは8バイト(ブリッジプライオリティとMACアドレス)で構成される
- ブリッジプライオリティ
  - 範囲 : `0〜65535`
  - デフォルト値:`32768`
    - この値は管理者によって変更可能
  -  ブリッジプライオリティ値が同じ場合はMACアドレスによってルートブリッジを選出
    - 最小のMACアドレスが選出  
    

- STPのポート役割
-> http://bit.ly/1TsTz5e を参照(図を交えて詳しく説明されている)

(メモ)
- ブリッジID = MACアドレス
- パスコストが同じ場合は、最終的にブリッジID(MACアドレス)で小さい方がDP
- 非指定ポート(データフレームの送受信はしないがBPDUの受信は行う)
- ルートパスコストが同じ場合、ポートロールの選択は「送信元ポートID」を比較する。
- STPのブリッジプライオリティはVLANごとに異なる値を設定できる
```
(config)#spanning-tree vlan <vlan-id> priority <priority>

(*)VLANごとのプライオリティ値を0または4096の倍数で指定(デフォルトは32768)
```

- **ルートポートの決め方**
1. ルートパスコストを比較
2. 送信元ブリッジIDを比較
3. 送信元ポートIDを比較
(*)STPでは常に値が小さい方を優先


**[ルートパスコスト]**

|リンク速度  |コスト       |
|:-----------|:------------|
|10 Gps      | 2           |
|1 Gps       | 4           |
|100 Mps     | 19          |
|10 Mps      |100          |


- インタフェースの表示
  - Gi (1Gbps)
    - コスト: 4 
  - Fa (100Mbps)
    - コスト: 19   

- STPが動作しているスイッチのポートにケーブルを接続すると下記のように遷移する
1. ブロッキング
2. リスニング
3. ラーニング
4. フォワーディング
 
|タイマー    |説明          |デフォルト|
|:-----------|:------------|----------|
|Helloタイム |BPDUの送信間隔|2秒       |
|最大経過時間 |受信したBPDUを保持する時間|20秒       |
|転送遅延 |リスニング状態とラーニング状態を継続する時間|15秒       |


- **スパニングツリー状態確認コマンド**
- `show spanning-tree [vlan <vlan-id>] [detail]`
  - vlan-idを指定すると指定したVLANのSTP情報のみを表示できる 
  
- **PVST+ (Per VLAN Spanning Tree Plus)**
  - Cisco独自のSTP拡張機能でVLANごとに異なるIEEE 802.1DのSTPインスタンスを生成する 
  - VLANごとにルートブリッジの位置を最適化し、ブロッキング状態のポートを分散する
    - (メリット)データフレームの転送経路を負荷分散できる
      - 管理者がブリッジプライオリティ値を設定することができる 
    - (デメリット)VLANの数が多いとVLANごとにSTPを計算するためCPUのリソースを消費する







