### Chapter1 ネットワークの基礎とTCP/IP

- MDI :コンピュータ
- NIC :ルータ
- MDI-X : ハブ/スイッチ
- Auto MDI/MDI-X : 接続されたケーブルに応じてMDIとMDI-Xを判別して接続する

- 光ケーブル
 - シングルモード
 - マルチモード　
 ※ コネクタの形状はSCやFCなどある
 
##### OSI参照モデル

- 標準インターフェースを定義することでマルチベンダに相互接続できる
- ネットワーク処理を分割することで開発設計が容易になる

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/osi-model-fig2.jpg)

- メモ
  - 物理層
    - ケーブルや電気信号などを定義し、ビットを正しく伝送する
    - 電気信号をビット列に変換
  - ネットワーク層
    - 異なるNWを相互接続
    - エンドーツーエンドで最短経路を決める
  - データリンク層
    - ヘッダとトレーラを外してネットワーク層へ渡す
  - プレゼンテーション層
    - 文字コード、圧縮方式の表現方式

- カプセル化
  - 上位層プロトコルから渡されたデータにヘッダを付加
- トレーラ
  - 受信したデータのエラーチェック

**PDU(Protocol Data Unit)**

->データにヘッダが付加されて各層で抜かれるデータの単位

|レイヤー    |PDUの名前         |
|:-----------|:------------|
|4層:トランスポート層|セグメント|
|3層:ネットワーク層|パケット|
|2層:データリンク層|フレーム|
|1層:物理層|ビット|
   
 [データが送信される際、データがカプセル化されて物理的な信号に変換されるまで]
 
 `データ`->`セグメント`->`パケット`->`フレーム`->`ビット`
    
[DIX仕様のイーサネットフレーム]

|宛先MACアドレス|送信元MACアドレス|タイプ|データ|FCS|
|:-----------|:------------|:------------|:------------|:------------|


- **MACアドレス**
 - 48bitで12桁の16進数
 - 8bitごとに`-`か`:`で区切る
 - ベンダーによっては16bitごとに`.`で区切る
 - 小文字/大文字の区別はない

|OUI(24bit)|ベンダーコード(24bit)|
|:-----------|:------------|


- 接続ケーブル
 - クロスケーブル
   - 同じデバイス同士
 - ストレートケーブル
   - 異なるコネクタのデバイス同士
 - ロールオーバーケーブル
   - ルータ/スイッチのコンソールポートとコンピュータの接続 
 - シリアルケーブル
   - ルータのシリアルインターフェースと接続 
  
- CSMA/CD
 - CS(Carrier Sense)
   - ケーブル上に信号が流れていないか確認
 - MA(Multiple Access)
   - すべてのホストが平等に送信権利をもち、ケーブルを共有する 
 - CD (Collision Detection)
   - 衝突を検出すると、ジャム信号を送信してランダム時間待機する(バックオフ) 
 
- 全二重/半二重
 - 全二重(full duplex)
   - データの送信と受信を同時に行うことができるために、コリジョンが発生しない
 - 半二重(half duplex)
   - データの送信と受信を同時に行うことができないために、コリジョンが発生する
   - ハブと接続すると半二重通信になる 

- ハブとスイッチとルータの特徴
 - ハブ(リピータハブ)
    - Layer1(物理)デバイス 
    - 受信信号を増幅し、すべてのポートに信号を中継(受信ポートは除く)
    - コリジョンドメインを分割できない
 - スイッチ
    - Layer2(データリンク層)デバイス
    - MACアドレスに基づきフレームを転送する
    - コリジョンドメインを分割できる
    - L2スイッチはVLANを実装することでブロードキャストドメインを分割できる
 - ルータ
    - L3スイッチ(ルータ)はブロードキャストドメインを分割できる 
    - 受信パケットの宛先IPアドレスとルーティングテーブルを参照し、発信インターフェースへパケットをスイッチングする
    - Layer3(ネットワーク層)のデバイス
    - IPアドレスなど論理アドレスを基に最短経路を決定してパケットを中継する
    - インターフェース(ポート)ごとに異なるネットワークを相互接続する
    - イーサネット以外に様々なインターフェースを持つことができる(シリアルインターフェースは専用線やフレームリレーなどのWANサービスへ接続を提供する)
    - インターフェース単位でブロードキャストドメインを分割できる
    - 相互接続する2つのネットワークが異なる場合、適切なメディアに変換してパケットを中継する
   
 - トランスポート層の定義
   - Layer4で通信の信頼性を提供するための機能を定義している 
   - 仮想回線(コネクション)の確立、維持、終了
   - フロー制御
   - 順序制御
   - 確認応答
   - 再送制御
  
- UDP(User Datagram Protocol)
  - コネクションレス型のトランスポート層のプロトコル
  - 効率のよりデータ転送を行う 
  - ベストエフォート
- TCP
  - コネクション型のプロトコル
  - ネットワーク層
- TFTP
  - アプリケーション層プロトコル 

- ブリッジとスイッチについて
  - 両方ともMACアドレスを基にフレームの転送を行うLayer2(データリンク層)デバイス
  - 両方ともコリジョンドメインを分割できる
  - ブロードキャストドメインは分割できない
  - ブロードキャストのフレームを受信すると(受信ポートを除く)すべてのポートからフレームを転送する
  - スイッチはフレームの中継を高速にするためにASICと呼ばれるスイッチング処理専用のICチップを搭載
  - スイッチ(ハードウェア処理/ポート(多))はブレッジ(ソフトウェア処理/ポート(少))より高速にフレームを転送できる
  

**[OSI参照モデルとTCP/IPの改装モデル]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/osi-tcpicstack-fig.png)


**[TCP/IPプロトコルスタック]**
- アプリケーション層
  - ネットワークアプリケーションに必要なサービスを定義
- トランスポート層
  - アプリケーション層のプロトコルに信頼性のあるサービスを提供
- インターネット層
  - End to Endのデバイス間でパケットを転送するサービス
- ネットワーク/インターフェース層
  - 同一の物理ネットワークに接続された隣接ノードと通信を行うために必要なプロトコルとハードウェアを定義

IP(Internet Protocol)について
- コネクションレス型のプロトコル
- ベストエフォート型の配信
- データ回復機能なし
- 階層型アドレッシング

**[IPv4ヘッダフォーマット]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/ipv4-header.png)


- TCP(Transmission Control Protocol)
  - コネクション型のトランスポート層のプロトコル
  - 上位層から渡されたデータをネットワーク層のMTU(最大転送ユニット)に適したサイズに分割し、セグメントを生成する
  - TCPヘッダには送信元と宛先のポート番号が含まれる
  - 信頼性のある通信を実現するために
    - 3ウェイハンドシェイク(コネクションの確立)
      - コネクションを確立してからデータを転送する 
    - シーケンス番号による順序制御
    - 確認応答
    - 再送制御
    - ウィンドウによるフロー制御
    - 輻輳制御
    - エラー制御
    

**[3ウェイハンドシェイク]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/3wayhandshake.png)

- **トランスポート層のプロトコル(TCP/IP)**
  - TCP
    - コネクション型
    - 高信頼性
    - シーケンス番号による順序制御
    - データ単位はセグメント
  - UDP
    - コネクションレス型
    - ベストエフォート型
    - 確認応答なし
    - オーバヘッドが小さい
    - 音声やビデオストリーミングに適している
    - データの単位はデータグラム
    - UDPヘッダには送信元ポート/宛先ポート/長さ/テェックサム が含まれる
  
**[ARP]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Network_Study/arp-image.jpg)

- ARP(Address Resolution Protocol)
  -  **IPアドレスから**MACアドレスを取得するためのプロトコル
  -  ブロードキャストを利用して同じネットワークに接続されているすべてのノードにリクエストする
  -  リクエストされたアドレスが自身のIPアドレスと一致したノードはARPリプライ(応答)メッセージをユニキャストで送信する

